<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>AvaN0x - Cookies</title>
  <link rel="stylesheet" media="screen and (min-width:721px)" href="../style.css" />
  <link rel="stylesheet" media="screen and (max-width:720px)" href="../mobile.css" />
  <meta name="viewport" content="width=max-device-width, initial-scale=1" />
  <!-- DISCORD -->
  <meta property="og:title" content="AvaN0x - Cookies" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://avan0x.github.io/" />
  <meta property="og:image" content="https://avatars3.githubusercontent.com/u/27494805?s=460&v=4" />
  <meta property="og:description" content="Gestionnaire d'utilisation des cookies sur le site" />

  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="https://avatars3.githubusercontent.com/u/27494805?s=460&v=4" />

  <script src="https://kit.fontawesome.com/0383df481c.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
</head>

<body>
  <div id="menu">
    <script>
      $(function () {
        $("div#menu").load("../menu.html", cookieCheck());
      });
    </script>
  </div>
  <div id="cookieAccepter">
    <p></p>
    <input type="submit" value="Accepter les cookies" />
  </div>


  <section>
    <h1>Utilisation des cookies</h1>
    <input type="submit" value="Supprimer tous les cookies" name="delCookies" ; />
    <p id="delCookiesText" style="text-align: center"></p>
    <table id="cookieTable">
      <caption>Tableau des cookies du site</caption>
      <tbody>
        <tr>
          <th>Cookie name</th>
          <th>Cookie value</th>
        </tr>
      </tbody>
    </table>
  </section>
  <footer></footer>
  <script src="../src/cookie.js"></script>
  <script>
    console.log(document.cookie);
    $("input[type=submit][name=delCookies]").click(function () {
      document.cookie.split(";").forEach(function (c) {
        document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() +
          ";path=/");
      });

      cookieCheck();
      $("#delCookiesText").html("Tous les cookies ont été supprimés.");
    })

    $(document).ready(function () {
      cookieCheck();
    })

    function fillCookieTable() {
      if (document.cookie) { // s'il existe des cookies, on remplis le tableau
        document.cookie.split(";").forEach(function (c) {
          $("table#cookieTable").css("display", "inherit");
          c = c.split("=");
          $("table#cookieTable").append("<tr><td>" + c[0].trim() + "</td><td>" + c[1].trim() +
            "</td><td onclick='removeCookie(\"" + c[0].trim() + "\")' title='Supprimer le cookie \"" + c[0]
          .trim() + "\"'><i class='fas fa-times'></i></td></tr>");
        });

      } else {
        $("table#cookieTable").css("display", "none"); // sinon on cache le tableau
      }
    }

    $('label input:checkbox').change(function () {
      cookieCheck();
      console.log("hehe");
    })

    function cookieCheck() {
      if (!document.cookie) // s'il n'y a pas de cookies 
        $("input[type=submit][name=delCookies]").attr("disabled", true); // on desactive le bouton
      else
        $("input[type=submit][name=delCookies]").attr("disabled", false); // on active le bouton

      if (getCookie("cookiesAccepted") == null) { // si le cookies d'acceptation des cookies n'existe pas, on l'affiche
        $("#cookieAccepter").css("display", "flex");
        $("#cookieAccepter").css("transform", "translateY(0)");
      }

      $("table#cookieTable tr:not(:first-child)").remove(); //supprimer les lignes restantes
      fillCookieTable();
    }

    function removeCookie(cookieName) {
      setCookie(cookieName, "", 0); // on supprime le cookie
      cookieCheck();
    }

    $("#cookieAccepter input[type=submit]").click(function () {
      cookieCheck();
    })
  </script>
</body>

</html>