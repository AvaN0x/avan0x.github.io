<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Site d'AvaN0x</title>
    <link rel="stylesheet" media="screen and (min-width:721px)" href="style.css" />
    <link rel="stylesheet" media="screen and (max-width:720px)" href="mobile.css" />
    <meta name="viewport"  content="width=max-device-width, initial-scale=1" />
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script src="https://kit.fontawesome.com/0383df481c.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="https://avatars3.githubusercontent.com/u/27494805?s=460&v=4" />
  </head>
  <body>
    <header>
      <script>
        $(function () {
          $("header").load("menu.html");
        });
      </script>
    </header>

    <div class="cover">
      <div>
        <h1>AvaN0x / Clément RICATTE</h1>
        <p><a href="#section"><i class="fas fa-angle-double-down"></i></a></p>
      </div>
    </div>
    <section id="section">
      <h1>AvaN0x / Clément RICATTE</h1>
      <h2>Présentation</h2>
      <p class="text-indent">
        Je m'appelle Clément, j'ai <span class="age mainColor" title="Age généré automatiquement"></span> ans, je suis actuellement en première année de 
        <a href="http://iut-metz.univ-lorraine.fr/dut-informatique">DUT Info</a> à l'<a href="http://iut-metz.univ-lorraine.fr/">IUT de Metz</a>.
      </p>
      <h2>Bienvenue sur mon site personnel</h2>
      <p class="text-indent">
        Le site a été réalisé en tant que hobby lors de mes études, son design n'est pas fixe, il peut totalement changer du jour au lendemain, en fonction de mes gouts /
        j'ai appris de nouvelles astuces que je veux mettre en pratique.
      </p>
      <h2>Navigation</h2>
      <p class="text-indent">
        Le <a class="menu_toggle mainColor" style="cursor: pointer;">menu</a> vous permet de visiter toutes les pages que j'ai réalisées, et autres.
      </p>
      <h1>Temps restant à attendre</h1>
      <div id="holidayTimer"> <!-- script dans menu.html -->
        <p></p>

        <div class="days">
          <span>00</span>
          <span>jours</span>
        </div>
        <div class="hours">
          <span>00</span>
          <span>heures</span>
        </div>
        <div class="minutes">
          <span>00</span>
          <span>minutes</span>
        </div>
        <div class="seconds">
          <span>00</span>
          <span>secondes</span>  
        </div>


        <div>
          <label>
            <input type="radio" name="duree" value="1" title="Durée des vacances" checked/>
            <span>1sem</span>
          </label>
          <label>
            <input type="radio" name="duree" value="2" title="Durée des vacances"/>
            <span>2sem</span>
          </label>


          <label>
            <input type="radio" name="zone" value="C" title="Zone scolaire ou vous vous trouvez"/>
            <span>C</span>
          </label>
          <label>
            <input type="radio" name="zone" value="B" title="Zone scolaire ou vous vous trouvez" checked/>
            <span>B</span>
          </label>
          <label>
            <input type="radio" name="zone" value="A" title="Zone scolaire ou vous vous trouvez"/>
            <span>A</span>
          </label>
          <!-- <label>
            <input type="radio" name="zone" value="S" title="Etudes supérieures"/>
            <span>SUPP</span>
          </label> -->
        </div>



      </div>
    </section>
    <script>
      var goalDate;


      $(document).ready(function(){
        console.log("cookie : " + document.cookie);
        // Affichage de l'age
        var yearOld = new Date( new Date().getTime() - new Date("2001-10-09").getTime() ).getFullYear() - 1970;
        $("span.age").text(yearOld);
        // Affichage du nombre de jours depuis l'anniversaire en hover de l'age
        var daySinceBirthday = Math.floor(( new Date().getTime() - new Date(2001 + yearOld, 9, 9).getTime() )/ 86400000);
        $("span.age").prop("title", "et " + daySinceBirthday + " jours.");


        var duree = (getCookie("duree") != null) ? getCookie("duree") : "1";
        var zone = (getCookie("zone") != null) ? getCookie("zone") : "B";
        $("#holidayTimer label input[name=duree][value=" + duree + "]").prop('checked', true);
        $("#holidayTimer label input[name=zone][value=" + zone + "]").prop('checked', true);

        getGoalDate();
        holidayTimer();
        setInterval(holidayTimer, 1000);
      })


      $("#holidayTimer label input").change(function(){
        getGoalDate();
        holidayTimer();
        setCookie(this.name, this.value);
      });




      /////////////////////////
      //// Timer functions ////
      /////////////////////////

      function getGoalDate() {
        var holidayDate = {
            "date":[
              // holidays == 1 -> début vacances, sinon fin vacances
              // dates basées sur la zone C (première zone en vacance)
              {"holidays": 1, "affectedByZones":"1", "date": new Date(2020, 1, 7, 17, 30).getTime() }, // mois - 1
              {"holidays": 0, "affectedByZones":"1", "date": new Date(2020, 1, 17, 8, 0).getTime() },
              {"holidays": 1, "affectedByZones":"1", "date": new Date(2020, 3, 3, 17, 30).getTime() },
              {"holidays": 0, "affectedByZones":"1", "date": new Date(2020, 3, 13, 8, 0).getTime() },
              {"holidays": 1, "affectedByZones":"0", "date": new Date(2020, 5, 26, 17, 30).getTime() }
            ]
          }

          for (var i = 0; i < Object.keys(holidayDate.date).length; i++) {
            var shift = 0;
            if (holidayDate.date[i].affectedByZones) {
              switch($("#holidayTimer label input[name=zone]:checked").val()) {
                case 'A':
                  shift += 604800 * 2 * 1000;
                  break;
                case 'B':
                  shift += 604800 * 1000;
                  break;
              }
            }

            if ($("#holidayTimer label input[name=duree]:checked").val() == 2 && holidayDate.date[i].holidays == 0) {
              shift += 604800 * 1000;
            }


            if (new Date().getTime() < (holidayDate.date[i].date + shift)) {
              goalDate = holidayDate.date[i].date + shift;

              console.log("Date countdown " + (goalDate - new Date().getTime()) + ", holidays : " + holidayDate.date[i].holidays + ", affectedByZones : " + holidayDate.date[i].affectedByZones);
              // console.log(Object.keys(holidayDate.date).length + " dates disponibles.");
              break;
            }

          }

          if (holidayDate.date[i].holidays) {
            // page d'accueil
            $("#holidayTimer > p").text("Avant les prochaines vacances :D");
          }
          else {
            // page d'accueil
            $("#holidayTimer > p").text("Avant la fin des vacances :(");
          }
      }


      function holidayTimer() {
        var time = Math.floor((goalDate - new Date().getTime())/1000);
        var d = Math.floor(time / 86400);
        var h = Math.floor((time % 86400) / 3600);
        var m = Math.floor(( (time % 86400) % 3600) / 60);
        var s = Math.floor(( (time % 86400) % 3600) % 60);
        
        if (time >= 0) {
          // page accueil
          $('#holidayTimer .days span:eq(0)').html((d < 10) ? "0" + d : d);
          $('#holidayTimer .hours span:eq(0)').html((h < 10) ? "0" + h : h);
          $('#holidayTimer .minutes span:eq(0)').html((m < 10) ? "0" + m : m);
          $('#holidayTimer .seconds span:eq(0)').html((s < 10) ? "0" + s : s);
        }
        if (time == -1)
          getGoalDate()
      }




      ///////////////////////////
      //// Cookies functions ////
      ///////////////////////////

      function setCookie(cookieName, cookieValue) {
        var d = new Date();
        d.setTime(d.getTime() + (365 * 24 * 60 * 60 * 1000));
        var expires = "expires=" + d.toUTCString();
        document.cookie = cookieName + "=" + cookieValue + ";" + expires + ";path=/";
      }

      function getCookie(cookieName) {
        var name = cookieName + "=";
        var cookieTable = document.cookie.split(';');
        for(var i = 0; i < cookieTable.length; i++) {
          var c = cookieTable[i];
          while (c.charAt(0) == ' ') 
            c = c.substring(1);
          if (c.indexOf(name) == 0) 
            return c.substring(name.length, c.length);
        }
        return null;
      }
    </script>
  </body>
</html>
